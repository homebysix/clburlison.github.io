<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Setup Mandrill on Ubuntu 14.04 - Part 2  &middot; clburlison</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="munki, ubuntu, ">


<meta property="og:title" content="Setup Mandrill on Ubuntu 14.04 - Part 2  &middot; clburlison ">
<meta property="og:site_name" content="clburlison"/>
<meta property="og:url" content="https://clburlison.com/munkirepo-guide-part-2/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-10-17T00:00:00Z" />
<meta property="og:article:modified_time" content="2014-10-17T00:00:00Z" />

  
    
<meta property="og:article:tag" content="munki">
    
<meta property="og:article:tag" content="ubuntu">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@clburlison" />
<meta name="twitter:creator" content="@clburlison" />
<meta name="twitter:title" content="Setup Mandrill on Ubuntu 14.04 - Part 2" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://clburlison.com/munkirepo-guide-part-2/" />
<meta name="twitter:domain" content="https://clburlison.com/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Setup Mandrill on Ubuntu 14.04 - Part 2",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-10-17",
    "description": "",
    "wordCount": 847
  }
</script>



<link rel="canonical" href="https://clburlison.com/munkirepo-guide-part-2/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://clburlison.com/touch-icon-144-precomposed.png">
<link href="https://clburlison.com/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.19" />

  <!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://clburlison.com/css/font-awesome.min.css">
<link rel="stylesheet" href="https://clburlison.com/css/style.css">
<link rel="stylesheet" href="https://clburlison.com/css/highlight/default.css">

  
  
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-49614309-2', 'auto');
	  ga('send', 'pageview');

	</script>

</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="https://clburlison.com/">
  clburlison

</a>

</div>

  
<div class="container topline">
  
  A Mac sysadmin, documenting useful code, ideas, &amp; guides.


</div>


</div>

  <nav class="container nav primary no-print">
  

<a class="homelink" href="https://clburlison.com/">Home</a>


  
<a href="https://clburlison.com/about">About</a>

<a href="https://clburlison.com/post" title="Show list of posts">Posts</a>

<a href="https://clburlison.com/resources">Resources</a>

<a href="https://clburlison.com/tags" title="Show list of tags">Tags</a>

<a href="https://clburlison.com/talks">Talks</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" href="mailto:clburlison@gmail.com">
  <span class="fa fa-envelope-square"></span><span>email</span></a>



<a id="contact-link-github" class="contact_link" href="https://github.com/clburlison">
  <span class="fa fa-github-square"></span><span>github</span></a>





<a id="contact-link-linkedin" class="contact_link" href="https://www.linkedin.com/in/clburlison">
  <span class="fa fa-linkedin-square"></span><span>linkedin</span></a>







<a id="contact-link-twitter" class="contact_link" href="https://twitter.com/clburlison">
  <span class="fa fa-twitter-square"></span><span>twitter</span></a>













</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Setup Mandrill on Ubuntu 14.04 - Part 2
</h1>

  <div class="metas">
<time datetime="2014-10-17">Oct 17, 2014</time>


  
  &middot; Read in about 4 min
  &middot; (847 Words)
  <br>
  
<a class="label" href="https://clburlison.com/tags/munki">munki</a>

<a class="label" href="https://clburlison.com/tags/ubuntu">ubuntu</a>



</div>

</header>

  

<nav class="toc">
<input id="ac-toc" name="accordion-toc" type="checkbox">
<label for="ac-toc">Table of Contents</label>
<div id="toc" class="toc__menu">
<nav id="TableOfContents">
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#the-install">The Install</a>
<ul>
<li><a href="#creating-users-groups">Creating Users &amp; Groups</a></li>
<li><a href="#install-build-tools">Install build tools</a></li>
<li><a href="#install-nodejs">Install NodeJS</a></li>
<li><a href="#install-nginx-pm2">Install Nginx &amp; pm2</a></li>
<li><a href="#configuring-pm2">Configuring pm2</a></li>
<li><a href="#configuring-nginx">Configuring Nginx</a></li>
<li><a href="#install-meteor">Install Meteor</a></li>
<li><a href="#install-mongodb">Install MongoDB</a></li>
<li><a href="#installing-mandrill">Installing Mandrill</a></li>
<li><a href="#mandrill-settings">Mandrill Settings</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav>
</div>
</input>
</nav>



  <div class="container content">
  

<div class="alert alert-danger">
  <p><strong>Update:</strong> This article should only be used for reference at this time. Mandrill has been great for many years but no longer has an active maintainer. Please use MunkiWebAdmin 2 (mwa2) from <a href="https://github.com/munki/mwa2" target="_blank">github.com/munki/mwa2</a> instead.</p>

</div>


<h1 id="intro">Intro</h1>

<p>This is Part 2 of a series on setting up a munki server on Ubuntu 14.04. Read <a href="/blog/2014/10/06/munkirepo-guide-part-1/">Part 1 here</a>. This section goes over setting up <a href="https://github.com/wollardj/Mandrill" target="_blank">Mandrill</a> so we can edit our repo metadata files, modify manifests, and assign new software to our fleet using a web browser.</p>

<p>A brief description of Mandrill.</p>

<blockquote>
<p>Multi-user web front-end for managing a Munki repository. If you&rsquo;re here because of MailChimp, my apologies but this isn&rsquo;t the Mandrill you&rsquo;re looking for. /wavehand</p>

<p>Mandrill is a NodeJS web application written using the Meteor framework. It supports one database engine: MongoDB. There are no plans to support other engines, but fear not, mandrillctl will install and secure MongoDB for you. If you already have MongoDB running on your server via homebrew, you should probably remove that installation first, or use an alternate server.</p>

<p>&ndash;Joe Wollard</p>
</blockquote>

<p><img src="/images/2014-10-19/mandrill.png" alt="" /></p>

<h1 id="the-install">The Install</h1>

<p>Lucky for us Joe, the developer, has excellent documentation for installation on Ubuntu. Unfortunately, the documentation is for an older version of Ubuntu and some of the commands need modification to work with 14.04 and this series. Instead of redirecting you back and forth between his guide and this, I decided to include all the commands required below without the descriptions. For more information on what/why you are doing something please reference the wiki <a href="https://github.com/wollardj/Mandrill/wiki" target="_blank">here</a>.</p>

<h2 id="creating-users-groups">Creating Users &amp; Groups</h2>

<p>Lets create the Mandrill user and munki group along with allow mandrill access to modify our munki repo.</p>

<pre><code class="language-bash">sudo addgroup --system munki
sudo adduser --system _mandrill --ingroup munki --force-badname
sudo chown -R _mandrill:munki /usr/local/munki_repo/
sudo chmod -R 2774 /usr/local/munki_repo
</code></pre>

<div class="alert alert-info">
  <p><strong>Note:</strong> You should receive an error from creating the &lsquo;munki&rsquo; group if you went through <a href="/munkirepo-guide-part-1/">Part 1</a>. This is fine move along.</p>

</div>


<h2 id="install-build-tools">Install build tools</h2>

<pre><code class="language-bash">sudo apt-get install git curl build-essential
</code></pre>

<h2 id="install-nodejs">Install NodeJS</h2>

<pre><code class="language-bash">cd ~/
curl -O http://nodejs.org/dist/v0.10.26/node-v0.10.26-linux-x64.tar.gz
sudo tar --strip-components 1 -C /usr/local -zxf node-v0.10.26-linux-x64.tar.gz
rm node-v0.10.26-linux-x64.tar.gz
</code></pre>

<h2 id="install-nginx-pm2">Install Nginx &amp; pm2</h2>

<pre><code class="language-bash">sudo apt-get install nginx
sudo npm install pm2 -g --unsafe-perm # updated from wiki

# install startup scripts to make sure pm2 and all its daemons
# respawn when the server reboots.
sudo pm2 startup ubuntu
</code></pre>

<h2 id="configuring-pm2">Configuring pm2</h2>

<p><em>&ndash;direct from wiki start&ndash;</em><br />
Be sure to change ROOT_URL and PORT to values appropriate for your environment! If you&rsquo;re running a MongoDB instance on another server, or if your MongoDB instance requires authentication, you should change MONGO_URL as well.</p>

<p>One thing you should not change is instances as Mandrill is not currently aware of other instances of itself and will needlessly consume resources.<br />
<em>&ndash;end&ndash;</em></p>

<p><code>sudo nano /usr/local/etc/mandrilld.json</code></p>

<pre><code class="language-bash">
[{
    &quot;name&quot;: &quot;mandrilld&quot;,
    &quot;script&quot;: &quot;/usr/local/Mandrill/main.js&quot;,
    &quot;env&quot;: {
        &quot;ROOT_URL&quot;: &quot;http://192.168.20.133:3001&quot;,
        &quot;PORT&quot;: &quot;3001&quot;,
        &quot;MONGO_URL&quot;: &quot;mongodb://localhost:27017/Mandrill&quot;,
        &quot;MANDRILL_MODE&quot;: &quot;production&quot;
    },
    &quot;instances&quot;: &quot;1&quot;,
    &quot;error_file&quot;: &quot;/var/log/mandrill/mandrill-err.log&quot;,
    &quot;out_file&quot;: &quot;/var/log/mandrill/mandrill.log&quot;,
    &quot;pid_file&quot;: &quot;/var/run/mandrill.pid&quot;
}]
</code></pre>

<p>The log directory must exist before you start mandrilld for the first time.</p>

<pre><code class="language-bash">sudo mkdir /var/log/mandrill
</code></pre>

<h2 id="configuring-nginx">Configuring Nginx</h2>

<p>If you read my Part 1 guide before October 19th you will want to follow the new steps from <a href="/blog/2014/10/06/munkirepo-guide-part-1/#setting-up-nginx">Part 1 - Setting up Nginx</a>. These changes were made in order to accommodate Munkireport, which we will setup next.</p>

<p>At this point, you have two options that you need to be aware of for using Mandrill:</p>

<ul>
<li>Use the  default port 3001</li>
<li>Setup a DNS A record for your server</li>
</ul>

<p>You get these choices since we will be setting up Munkireport next. Since I am not in charge of the network at my workplace I will simply leave Nginx alone and connect via port 3001. If however you would like to access Mandrill via a sub domain name or alternate address you can follow the original setup steps below. Just make sure and change your server_name to a record that is not the current hostname of your server. This change is necessary since by default Mandrill needs redirects for both the root directory of your web-server and /mandrill to work.</p>

<p><a href="https://github.com/wollardj/Mandrill/wiki/Configuring-Nginx-%28Ubuntu%29" target="_blank">Configuring Nginx in Ubuntu</a></p>

<h2 id="install-meteor">Install Meteor</h2>

<pre><code class="language-bash"># First, install meteor
curl https://install.meteor.com | /bin/sh

# next, install meteorite
sudo npm install -g meteorite
</code></pre>

<h2 id="install-mongodb">Install MongoDB</h2>

<pre><code class="language-bash">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 \
    --recv 7F0CEB10

echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' \
    | sudo tee /etc/apt/sources.list.d/mongodb.list

sudo apt-get update
sudo apt-get install mongodb-10gen
</code></pre>

<h2 id="installing-mandrill">Installing Mandrill</h2>

<pre><code class="language-bash">git clone https://github.com/wollardj/Mandrill.git

# If you want the latest source code, you're done. However,
# I suggest sticking with the latest release...
cd Mandrill
git checkout tags/`git tag -l | tail -n 1`

sudo mrt bundle Mandrill.tar.gz # updated from wiki

sudo mkdir /usr/local/Mandrill
sudo tar --strip-components 1 -C /usr/local/Mandrill -zxf Mandrill.tar.gz

</code></pre>

<p>Now lets manually start our mandrill site.</p>

<pre><code class="language-bash">sudo pm2 start /usr/local/etc/mandrilld.json
sudo service mongodb start
</code></pre>

<p>Visit to verify that everything is working [<a href="http://munki:3001](" target="_blank">http://munki:3001](</a>)</p>

<h2 id="mandrill-settings">Mandrill Settings</h2>

<p>Log into the web portal with the default username <em>admin</em> and password <em>admin</em>. You will obviously want to change this password to something more secure. Under the mandrill settings tab you will want to change your repo path to <code>/usr/local/munki_repo/</code>.</p>

<p><img src="/images/2014-10-19/mandrill_settings.png" alt="" /></p>

<h1 id="conclusion">Conclusion</h1>

<p>Mandrill is setup! Stay tuned for Part 3, setting up Munkireport.</p>

<hr />

<p>Articles:<br />
<a href="https://github.com/wollardj/Mandrill/wiki" target="_blank">Mandrill Wiki</a></p>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="https://clburlison.com/munkirepo-guide-part-1/" title="Setup a Munki repo on Ubuntu 14.04 - Part 1">
      Previous
    </a>
    

    
    <a class="next" href="https://clburlison.com/munkirepo-guide-part-3/" title="Setup Munkireport on Ubuntu 14.04 - Part 3">
      Next
    </a>
    

  


</div>

  <div class="container comments">
  <h2>Comments</h2>
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//clburlison.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  
  powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>.


</div>


  
<div class="container copyright">
  
  &copy; 2014 - 2017 Clayton Burlison


</div>


</div>

</footer>

    </main>
    
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//clburlison.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="https://clburlison.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


    
  </body>
</html>

