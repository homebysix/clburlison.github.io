<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Sign Packages with Luggage  &middot; clburlison</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="description" content="" />

<meta name="keywords" content="luggage, macos, ">


<meta property="og:title" content="Sign Packages with Luggage  &middot; clburlison ">
<meta property="og:site_name" content="clburlison"/>
<meta property="og:url" content="https://clburlison.com/sign-packages-with-luggage/" />
<meta property="og:locale" content="en-EN">


<meta property="og:type" content="article" />
<meta property="og:description" content=""/>
<meta property="og:article:published_time" content="2014-11-13T00:00:00Z" />
<meta property="og:article:modified_time" content="2014-11-13T00:00:00Z" />

  
    
<meta property="og:article:tag" content="luggage">
    
<meta property="og:article:tag" content="macos">
    
  

  
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@clburlison" />
<meta name="twitter:creator" content="@clburlison" />
<meta name="twitter:title" content="Sign Packages with Luggage" />
<meta name="twitter:description" content="" />
<meta name="twitter:url" content="https://clburlison.com/sign-packages-with-luggage/" />
<meta name="twitter:domain" content="https://clburlison.com/">
  

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Article",
    "headline": "Sign Packages with Luggage",
    "author": {
      "@type": "Person",
      "name": "http://profiles.google.com/+?rel=author"
    },
    "datePublished": "2014-11-13",
    "description": "",
    "wordCount": 907
  }
</script>



<link rel="canonical" href="https://clburlison.com/sign-packages-with-luggage/" />

<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://clburlison.com/touch-icon-144-precomposed.png">
<link href="https://clburlison.com/favicon.png" rel="icon">

<meta name="generator" content="Hugo 0.20" />

  
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link href='https://fonts.googleapis.com/css?family=Merriweather:300%7CRaleway%7COpen+Sans' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="https://clburlison.com/css/font-awesome.min.css">
<link rel="stylesheet" href="https://clburlison.com/css/style.css">
<link rel="stylesheet" href="https://clburlison.com/css/highlight/default.css">

  
  
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-49614309-2', 'auto');
	  ga('send', 'pageview');

	</script>

</head>
<body>
  <main id="main-wrapper" class="container main_wrapper has-sidebar">
    <header id="main-header" class="container main_header">
  <div class="container brand">
  <div class="container title h1-like">
  <a class="baselink" href="https://clburlison.com/">
  clburlison

</a>

</div>

  
<div class="container topline">
  
  A Mac sysadmin, documenting useful code, ideas, &amp; guides.


</div>


</div>

  <nav class="container nav primary no-print">
  

<a class="homelink" href="https://clburlison.com/">Home</a>


  
<a href="https://clburlison.com/about">About</a>

<a href="https://clburlison.com/post" title="Show list of posts">Posts</a>

<a href="https://clburlison.com/resources">Resources</a>

<a href="https://clburlison.com/tags" title="Show list of tags">Tags</a>

<a href="https://clburlison.com/talks">Talks</a>


</nav>

<div class="container nav secondary no-print">
  
<a id="contact-link-email" class="contact_link" href="mailto:clburlison@gmail.com">
  <span class="fa fa-envelope-square"></span><span>email</span></a>



<a id="contact-link-github" class="contact_link" href="https://github.com/clburlison">
  <span class="fa fa-github-square"></span><span>github</span></a>





<a id="contact-link-linkedin" class="contact_link" href="https://www.linkedin.com/in/clburlison">
  <span class="fa fa-linkedin-square"></span><span>linkedin</span></a>







<a id="contact-link-twitter" class="contact_link" href="https://twitter.com/clburlison">
  <span class="fa fa-twitter-square"></span><span>twitter</span></a>













</div>


  

</header>


<article id="main-content" class="container main_content single">
  <header class="container hat">
  <h1>Sign Packages with Luggage
</h1>

  <div class="metas">
<time datetime="2014-11-13">Nov 13, 2014</time>


  
  &middot; Read in about 5 min
  &middot; (907 Words)
  <br>
  
<a class="label" href="https://clburlison.com/tags/luggage">luggage</a>

<a class="label" href="https://clburlison.com/tags/macos">macos</a>



</div>

</header>

  




  <div class="container content">
  

<h1 id="intro">Intro</h1>

<p>Are you an Apple Developer? Most of the Apple Admin Community have developer accounts for the simple reason of gaining access to beta releases earlier than the public. This extra times allows us to test for changes that might affect the environments we support before it ends up in the hands of our users. Up until this point that is the only reason I could justify having a Dev account. Recently I found out that being a developer gives you the access to sign packages using a secure certificate from Apple, which I will document below.</p>

<p>As of October 24th, commit <a href="https://github.com/unixorn/luggage/commit/4d270a0dbc5f31bebbf9672d4a2970ad6316c8b4" target="_blank">4d270a0</a> of the Luggage project, packagemaker is no longer a requirement!! A pretty big deal since packagemaker has not seen an update since the late days of Snow Leopard. This update to Luggage, makes use of Apple&rsquo;s built-in pkgutil command to build native OS X packages. For quite some time you could force Luggage to use pkgutil but this required adding <code>PKGBUILD=1</code> to the top of every Makefile.</p>

<p>Luggage allows us to create packages that meet the following requirements:</p>

<ul>
<li>repeatability</li>
<li>mobile</li>
<li>sharable</li>
<li>easy incremental versioning</li>
</ul>

<h1 id="the-setup">The Setup</h1>

<p>The above is fantastic news and it lays the groundwork for Luggage to sign packages. Honestly, pkgutil is doing all of the hardwork behind the scene but I found documentation on using Luggage to sign packages spread all over. The goal below is to document the process of signing a package from start to finish.</p>

<div class="alert alert-info">
  <p><strong>Note:</strong> Apple recommends requesting a certificate via Xcode and while it is quite possible, and much easier, I found that the certificate generated via Xcode is only valid for 365 days. Doing it the manual method below creates a certificate valid for five (5) years.</p>

</div>


<h2 id="obtaining-the-certificate">Obtaining the certificate</h2>

<p>Visit the <a href="https://developer.apple.com" target="_blank">Apple Developer page</a> and login via the Member Center link (top right).</p>

<ol>
<li><p>Click the on the certificates section.
<img src="/images/2014-11-13/0-certiicates.png" alt="" /></p></li>

<li><p>Click on the Mac certificate section.
<img src="/images/2014-11-13/0-mac-certs.png" alt="" /></p></li>

<li><p>Create a new certificate from the plus (+) button.
<img src="/images/2014-11-13/0-new-cert.png" alt="" /></p></li>

<li><p>Create a new Developer ID.
<img src="/images/2014-11-13/1-create-dev-id.png" alt="" /></p></li>

<li><p>Create an &ldquo;installer&rdquo; certificate to use with Luggage.
<img src="/images/2014-11-13/2-dev-installer.png" alt="" /></p></li>

<li><p>The steps on this page explain how to create a certificate signing request (csr). I will detail the steps in following images. For now just open &ldquo;Keychain Access&rdquo;.
<img src="/images/2014-11-13/3-create-csr.png" alt="" /></p></li>

<li><p>Keychain Access &gt; Certificate Assistant &gt; Request a Certificate from a Certificate Authority&hellip;
<img src="/images/2014-11-13/4-keychain-csr.png" alt="" /></p></li>

<li><p>Fill in the Email address and Common Name.</p></li>
</ol>

<div class="alert alert-danger">
  <p><strong>Note:</strong> Do not fill in the CA Email per Apple&rsquo;s instructions.</p>

</div>


<p><img src="/images/2014-11-13/5-creating-the-csr.png" alt="" /></p>

<ol>
<li><p>After the CSR is created upload to Apple&rsquo;s website.
<img src="/images/2014-11-13/6-upload-csr.png" alt="" /></p></li>

<li><p>Generate the certificate.
<img src="/images/2014-11-13/7-generate-cert.png" alt="" /></p></li>

<li><p>Download your newly created certificate.
<img src="/images/2014-11-13/8-dl-cert.png" alt="" /></p></li>

<li><p>Double click your cert to install into your keychain. (I choice to install to my login keychain)<br />
<img src="/images/2014-11-13/9-install-cert.png" alt="" /></p></li>
</ol>

<p>For reference my certificate looks like the below.
<img src="/images/2014-11-13/10-sample-cert.png" alt="" /></p>

<h2 id="create-a-signed-package">Create a signed package</h2>

<p>Great we have a newly created certificate ready for us to use. Now we need to sign a package and what better package to sign then luggage itself.</p>

<p>If you already have the Luggage downloaded simply change directory into the project directory. Else download it with git using the following.</p>

<pre><code class="language-bash">git clone https://github.com/unixorn/luggage.git /your/luggage/path
cd /your/luggage/path
</code></pre>

<p>If by some chance you have made it this far without actually installing luggage run the following</p>

<pre><code class="language-bash">make bootstrap_files
</code></pre>

<p>Now lets make a non-signed package with luggage, that installs luggage (meta enough for ya), run the following:</p>

<pre><code class="language-bash">make pkg
</code></pre>

<p>Rename the package to <code>luggage-no-sign.pkg</code>. We are doing this for comparisons later.</p>

<p>To tell luggage to sign the package you need to add the following line of code inside of the Makefile at the beginning. Make sure to change the information in the double quotes with the name of your certificate (review image 11 above).</p>

<pre><code class="language-bash">PB_EXTRA_ARGS+= --sign &quot;Developer ID Installer: Clayton Burlison&quot;
</code></pre>

<p>If you are lost on where to add the code in the Makefile see the sample below:</p>

<pre><code class="language-bash">&lt;----------------
#
# Sample package that packages luggage.make and prototype.plist

include luggage.make
PB_EXTRA_ARGS+= --sign &quot;Developer ID Installer: Clayton Burlison&quot;

TITLE=luggage
REVERSE_DOMAIN=net.apesseekingknowledge
PAYLOAD=pack-luggage.make pack-prototype.plist \
	pack-usr-local-bin-app2luggage.rb

help::
	@-echo
	@-echo &quot;Installation&quot;
	@-echo
	@-echo &quot;To copy luggage's files to /usr/local/share/luggage: make bootstrap_files&quot;
----------------&gt;
</code></pre>

<p>Lastly, lets create the signed package.</p>

<pre><code class="language-bash">make pkg
</code></pre>

<p>If your login.keychain is locked or you decided to put your cert keys in a separate keychain you will see the following pop-up below. Simply type the password associated with that keychain to allow pkgutil to sign the package.</p>

<p><img src="/images/2014-11-13/12-access-to-keychain.png" alt="" /></p>

<p>Notice below the visual lock on the signed package. This package will be trusted with Gatekeeper using the default settings.
<img src="/images/2014-11-13/13-sign-vs-nonsign.png" alt="" /></p>

<p>If you click on the lock while in the installer window you can get details about the certificate used to sign a package.
<img src="/images/2014-11-13/14-verify-sign-package-cert.png" alt="" /></p>

<h2 id="pkgbuild-vs-packagemaker">Pkgbuild vs PackageMaker</h2>

<p>If you have any Makefiles using <code>postflight</code> scripts they will need to change the script type to <code>postinstall</code>. This is a requirement from using pkgutil.</p>

<h1 id="conclusion">Conclusion</h1>

<p>Signing packages might seem like a great idea. Lets sign all the packages&hellip;.but wait. Think of the reasons you are doing it first. It might make sense to <strong>not</strong> sign packages. For example, if you are creating packages that are only ever going to be ran in Munki, it is not a requirement for that package to be signed. If your certificate expires, you will need to recreate a new package. If however you want to distribute packages to you end-users via the internet it might be company policy or best practice to sign packages. Just wanted to give warnings.</p>

<h3 id="random-note">Random Note</h3>

<p>In the update to 10.9.5 - Gatekeeper was re-enabled. Seems Apple is really wanting to beef up their security game.</p>

<hr />

<p>Articles:<br />
<a href="https://groups.google.com/forum/?fromgroups#!topic/the-luggage/9WeNMBcvKjA" target="_blank">Productsign</a>,<br />
<a href="https://github.com/unixorn/luggage" target="_blank">Luggage</a>,<br />
<a href="https://groups.google.com/forum/?fromgroups#!topic/the-luggage/aCU9nNsMUaE" target="_blank">Pkgbuild vs PackageMaker</a></p>

</div>


  <footer class="container">
  <div class="container navigation no-print">
  <h2>Navigation</h2>
  
  

    
    <a class="prev" href="https://clburlison.com/preview-files-from-terminal/" title="Preview files from terminal">
      Previous
    </a>
    

    
    <a class="next" href="https://clburlison.com/munkireport-error-fix/" title="Fix Munkireport Error Request Too Large">
      Next
    </a>
    

  


</div>

  <div class="container comments">
  <h2>Comments</h2>
  
<div id="disqus_thread"></div>
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//clburlison.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

</footer>

</article>
      <footer id="main-footer" class="container main_footer">
  

  <div class="container nav foot no-print">
  

  <a class="toplink" href="#">back to top</a>

</div>

  <div class="container credits">
  
<div class="container footline">
  
  powered by <a href="https://gohugo.io/" target="_blank">Hugo</a>.


</div>


  
<div class="container copyright">
  
  &copy; 2014 - 2017 Clayton Burlison


</div>


</div>

</footer>

    </main>
    
<script type="text/javascript">
  (function() {
    
    
    if (window.location.hostname == "localhost")
      return;

    var dsq = document.createElement('script'); dsq.async = true; dsq.type = 'text/javascript';
    dsq.src = '//clburlison.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



<script src="https://clburlison.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


    
  </body>
</html>

